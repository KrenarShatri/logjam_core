<%= content_for(:page_scripts) do %>
var parameters = <%= raw Oj.dump(params) %>;
var parameter_defaults = <%= raw Oj.dump(default_header_parameters) %>;
var self_url = '<%= raw self_url %>';
var home_url = '<%= raw home_url %>';
var history_url = '<%= raw history_url %>';
  <% if @days %>
  var selectable_days = <%= raw Oj.dump(@days.map(&:to_s)) %>;
  <% end %>
var action_auto_complete_url = '<%= raw auto_complete_url_for_action_page %>';
var application_auto_complete_url = '<%= raw auto_complete_url_for_application_page %>';
<% end %>

<% action = action_name == "index" ? "" : action_name %>
<%= raw Oj.dump(params) %>
<header id="logjam-header">
  <h1 class="logo">LOGJAM</h1>
  <% unless @only_one_app %>
    <div class="application-chooser filter-item">
      <div id="application-chooser-ghost" class="ghost-container"></div>
        <label for="application-suggest">Application: </label>
        <% if params[:action] == 'dashboard' || !params[:app] %>
          <input tabindex="1" id="application-suggest" class="application-suggest growing-input" data-ghost-container="#application-chooser-ghost" type="text" placeholder="Choose Application">
        <% else %>
          <input tabindex="1" id="application-suggest" class="application-suggest growing-input" data-ghost-container="#application-chooser-ghost" type="text" placeholder="<%= params[:app] %>">
        <% end %>
      </label>
    </div>
  <% end %>

  <div class="date-chooser filter-item">
    <label for="datepicker">Date: </label>
    <% if params[:time_range] == "date" %>
      <input tabindex="2" size="11" type="text" value="<%= @date %>" id="datepicker" onchange="submit_filter_form()" />
    <% else %>
      <input tabindex="2" size="11" type="text" value="<%= @date %>" id="datepicker" readonly="readonly" disabled="disabled" />
    <% end %>
  </div>

  <div class="namespace-chooser filter-item">
    <div id="namespace-suggest-ghost" class="ghost-container"></div>
    <%
      if params[:page]
        value = params[:page]
      else
        value = 'by namespace or action'
      end
    %>
    <label for="namespace-suggest">Filter: </label>
    <input tabindex="3" id="namespace-suggest" class="autocomplete growing-input" data-ghost-container="#namespace-suggest-ghost" placeholder="<%= value %>" name="page" type="text" onchange="view_selected_pages()" />
    <% if value != 'by namespace or action' %>
      <i class="fa fa-times"></i>
    <% end %>
  </div>

  <% if @dataset && @dataset.has_frontend? %>
    <div class="section-chooser filter-item no-background">
      <div class="btn-group">
        <%= clean_link_to("Backend", params.merge(:section => "backend"),
                         {"data-menu" => "backend-menu", "class" => "btn#{' active' if params[:section] == 'backend'}"}) %>
        <%= clean_link_to("Frontend", params.merge(:section => "frontend", :grouping => "page"),
                         {"data-menu" => "frontend--menu", "class" => "btn#{' active' if params[:section] == 'frontend'}"}) %>
      </div>
    </div>
  <% end %>

  <% unless @only_one_env %>
    <div class="enviroment-chooser filter-item no-background">
      <div class="btn-group">
        <% @envs.map do |env| %>
          <% if params[:env] == env %>
            <button type="submit" class="btn active" onclick="view_selected_pages()" value="<%= env %>"><%= env %></button>
          <% else %>
            <button type="submit" class="btn" onclick="view_selected_pages()" value="<%= env %>"><%= env %></button>
          <% end %>
        <% end %>
      </div>
    </div>
  <% end %>
</header>

<script>

  $(function(){
    initialize_header()
    /* choose the enviroment */
    $('.enviroment-chooser .btn', '#logjam-header').on('mousedown', function(event){
      $('#env').val( $(this).val() );
    });

    /* remove namespace filter */
    $('.namespace-chooser .fa.fa-times').on('click', function(){
      $('#page').val('');
      submit_filter_form();
    })
  });

</script>


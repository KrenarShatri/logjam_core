<%= render "header" %>
<div id="logjam-container">
  <%= render "sidebar" %>
  <div id="logjam-content" class="app-dashboard">
    <h2><%= @title %> <%= hpn("of") %> (<%= @callers.size %>)</h2>
    <div class="app-overview" id="callers">
      <div class="controls item">
        <%= form_tag(params, :method => :get) do %>
          <%= hidden_field_tag :app, @app %>
          <%= hidden_field_tag :env, @env %>
          <%= hidden_field_tag :page, @page %>
          <span>Group by:</span>
          <%= select_tag 'group', options_for_select(callers_grouping_options, params[:group]), :onchange => "form.submit()" %>
          <span>Sort by:</span>
          <%= select_tag 'sort', options_for_select(callers_sorting_options, params[:sort]), :onchange => "form.submit()" %>
        <% end %>
      </div>
    </div>

    <div class="app-overview">
      <div class="item">
        <table class="full_stats">
          <tr><th>Application</th><th>Action</th><th>Calls</th><th>Distribution over time (0-24h, 2 minute intervals)</th></tr>
          <% @callers.each_with_index do |(caller, count), i| %>
            <% app, controller = caller.split('-') %>
            <% url = url_for(params.merge(:app => app, :page => controller)) unless controller.blank? %>
            <tr class='full_stats'>
              <td><%= app %></td>
              <td><%= link_to(controller, url) unless controller.blank? %></td>
              <td class="number"><%= integer_number(count) %></td>
              <td class='echart' id='<%= "echart-#{i}" %>'>
                  <%= render "echart", :exceptions => @caller_minutes[caller], :i => i, :url => url %>
              </td>
            </tr>
          <% end %>
        </table>
        <h4>Call Header Information</h4>
        <table id='caller-meta-info' class='full_stats'>
          <tr><td>Requests with call header:</td><td class='number'><%= integer_number(@call_count) %></td></tr>
          <% missing_count = @request_count - @call_count %>
          <tr><td>Requests without call header:</td><td class='number'><%= integer_number(missing_count) %></td></tr>
        </table>
      </div>
    </div>
  </div>
</div>

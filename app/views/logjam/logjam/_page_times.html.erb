<table class='full_stats'>
  <tr>
    <% resource = @dataset.resource
       resource_type = Logjam::Resource.resource_type(@dataset.resource)
       resource_name = hrn(resource)
       options = {:resource => resource} -%>
    <% if @dataset.grouping? -%>
      <th><%= @dataset.grouping_name %></th>
      <th <%= raw html_attributes_for_grouping_function("count","number of requests") %>>requests</th>
      <th <%= raw html_attributes_for_grouping_function("avg", "average") %>>avg <%= resource_name %></th>
      <th <%= raw html_attributes_for_grouping_function("stddev", "standard deviation")%>>stddev <%= resource_name %></th>
      <th <%= raw html_attributes_for_grouping_function("sum", "sum") %>>sum <%= resource_name %></th>
      <% if @dataset.accumulates_time? -%>
        <% options.merge!(:resource_total => @dataset.sum(resource))-%>
        <th>% of overall <%= raw resource_name.gsub(' ', '&nbsp;') %></th>
        <% if resource.to_sym != :total_time -%>
          <% options.merge!(:total_time => @dataset.sum("total_time")) -%>
          <th>% of total time</th>
        <% else %>
          <th <%= raw html_attributes_for_grouping_function("apdex", "apdex score") %>>apdex</th>
          <th>errors/warnings</th>
        <% end -%>
      <% end -%>
  </tr>
      <%= render "#{resource_type}_statistics", options.merge(:pages => @dataset.do_the_query) %>
    <% else -%>
      <th>severity</th>
      <th>rc</th>
      <th>time</th>
      <th>action</th>
      <th class="sorted"><%= resource_name %></th>
  </tr>
      <%= render "request_statistics", options.merge(:requests => @dataset.do_the_query) %>
    <% end -%>
</table>
